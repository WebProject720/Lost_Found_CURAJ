---
// export const prerender = false;
import {
  Input,
  Button,
  Button_Link,
  Line,
  LoaderCircle,
  Loader
} from "../../components/utility/Utility";
import AuthLayout from "../../layouts/AuthLayout.astro";

// import { RegisterRequest } from "../../APIs/auth/register";

// Astro.request.headers.set("Cache-Control", "public, max-age=3600");
// const errors = {
//   username: "",
//   enrollment: "",
//   password: "",
//   error: "",
//   status: true,
// };
// if (Astro.request.method === "POST") {
//   try {
//     const body = await Astro.request.formData();
//     const username = body.get("username");
//     const enrollment = body.get("enrollment");
//     const password = body.get("password");
//     const data = { username, enrollment, password };
//     if (!(errors.username && errors.enrollment && errors.password)) {
//       errors.error = "All Field required";
//       errors.status = false;
//       return new Response(
//         JSON.stringify({ error: "All fields are required", status: false }),
//         { status: 400, headers: { "Content-Type": "application/json" } }
//       );
//       return new Response(null);
//     }
//     console.log(data);
//   } catch (error) {
//     if (error instanceof Error) {
//       console.error(error.message);
//     }
//   }
// }
// const log = () => {
//   console.log("hello");
// };
---

<AuthLayout>
  <div class="flex flex-col gap-2">
    <div class="flex flex-nowrap gap-5 flex-col">
      <div class="py-3">
        <h1 class="text-black font-bold text-2xl">
          <center> Registration </center>
        </h1>
      </div>
      <Line />
      <form
        class="flex flex-col gap-5"
        method="POST"
        enctype="application/x-www-form-urlencoded"
        id="RegistrationForm"
      >
        <Input
          type="text"
          label="Username"
          placeholder="Username"
          name="username"
          minLength="4"
        />
        <Input
          type="text"
          label="Enrollment"
          placeholder="Enrollment"
          name="enrollment"
          text="@curaj.ac.in"
          minLength="4"
        />
        <Input
          type="password"
          label="Password"
          name="password"
          placeholder="Password"
          minLength="4"
        />
        <div class="w-full">
          {
              <p class="text-center text-red-600">
                <span id="error"></span>
              </p>
              <p class="text-center text-green-600">
                <span id="success"></span>
              </p>
              <div id="loader">

              </div>
          }
        </div>
        <div class="flex w-full justify-center">
          <Button type="submit">Submit</Button>
        </div>
      </form>
      <Line />
      <div class="w-full flex items-center justify-center">
        <div class="flex flex-row gap-5 flex-wrap justify-evenly w-full">
          <Button_Link to="/auth" className="bg-green-500 hover:bg-green-300"
            >Login</Button_Link
          >
          <Button_Link
            className="bg-gray-400 text-black border-0 border-black hover:bg-gray-300"
            >Forget Password</Button_Link
          >
        </div>
      </div>
    </div>
  </div>
</AuthLayout>
<script>
import { RegisterRequest } from "../../APIs/auth/register.astro";
  document
    .getElementById("RegistrationForm")
    ?.addEventListener("submit", (e: SubmitEvent) => {
      e.preventDefault();
      const form = new FormData(e.target as HTMLFormElement);
      const username = form.get("username");
      const enrollment = form.get("enrollment");
      const password = form.get("password");

      const error=document.getElementById('error');
      const success=document.getElementById('success');
      const loader=document.getElementById('loader');

      if(!(username&&enrollment&&password)){
        error!.innerText="All field required";
        return
      }
      type data={
    username:String,
    enroll:String,
    password:String
}
      const data=({ username , enroll:enrollment, password });
      RegisterRequest({ username , enroll:enrollment, password }as data).then((response)=>{
        console.log(response);
      }).catch((error)=>{
        console.log(error);
      })


    });
</script>
