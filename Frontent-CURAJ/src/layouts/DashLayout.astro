---
import Header from "../components/Header.astro";
import Navbar from "../components/Navbar";
import Sidebar from "../components/Sidebar.astro";
import { Loader } from "../components/utility/Loader";
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" href="/src/assets/logo.jpg" />
    <meta name="generator" content={Astro.generator} />
    <title>Lost & Found - CURAJ</title>
  </head>
  <body class="relative">
    <div
      class="w-screen h-screen flex justify-center items-center"
      id="loader-container"
    >
      <Loader />
    </div>
    <div  id="loader-container">
      <Header>
        <Navbar client:only />
      </Header>
      <main>
        <div>
          <slot />
        </div>
        <Sidebar />
      </main>
    </div>
  </body>
</html>
<script>
  import { navigate } from "astro:transitions/client";
  import { setUserLogin, setUserInfo, logout, getStoreData } from "../store";
  import { UserAPI } from "../APIs/users/usersAPI";
  const user = getStoreData();

  let loaderDiv = document.getElementById("loader-container");
  let container = document.getElementById("container");
  container?.classList.add("hidden");
  loaderDiv?.classList.add("flex");

  if (!user.isUserLogged || !user.loggedUser) {
    UserAPI(null, "/getuser")
      .then((res) => {
        if (res.status) {
          console.log(res);
          setUserLogin(true);
          setUserInfo(res.data);
          container?.classList.remove("hidden");
          loaderDiv?.classList.add("hidden");
        } else {
          logout();
          navigate("/auth");
        }
      })
      .catch((error) => {
        console.log(error);
        logout();
        navigate("/auth");
      });
  }
</script>
<style is:global>
  @import url("https://fonts.googleapis.com/css2?family=Cabin:ital,wght@0,400..700;1,400..700&display=swap");
  @import url("https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
  html,
  body {
    margin: 0;
    width: 100%;
    height: 100%;
    font-family: "Cabin", "Poppins", "monospace";
  }
</style>
